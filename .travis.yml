env:
  global:
  - secure: HPp7vd0qJ/QnSyyJvhi/W3F1TiJArrRzz2GVnsBYT3m36QxHhdrpX1USsAHTkpABj/p205wuUN0pxhLCzdMjMi7mBKD6f54sAsP9TqgkdLxYB5StJsTzput28ctf4B1e9A/vuu87Nk4YyYl4+ZiMeg6Ytl6Zit4Tq+V4AmaugkKT9E+ddsVODGry2mGJ1zv/55dl/Ofx7tsQpc8amYQw6eZUYSx9A2e2zaV9IB1q7EC+39x70EeUbn6AXr0WNfFLdwzGxW22aep/6HwtH+yPoEi1kdw7yyiyELS01u9A+TmdddiFYPxSSW03YUzPp5yxUKYU/1N1EHPEBSHpHaCmM029wKxl+gT+JLr66PKwHjCefyTBNfbMUpSx/MFPFau1aPNBGO5GeSFqOS18lTJZSkl+sXsQVCWdgq3Cuf1e7BhrHY+t6ZSTYIAl6jrDuiOQONpELsftXxZsxPVlogHsAB2fsYFTJ7exhsIBTVNF0n/c0FJlVBkm2dku1bk10eJC7RC8JEthw6KJxDveFdpJJoG5hYwIuAG63dbcU6Pjg81s1YSA6VT2vSps/wcMJrLonCha1Woc1rvfcf4SWGkPKJlENo8tv/vSoenVGesra/RDpKH9FALWqA4XbHOPuvXTHJBUXn8qI6Is+wFCnLwh/oC86OfTjtqZHRbRB/jNRi4=
  - secure: cy+O5fFbA8hktx39e5DgWFK4vwnWB3MvZxwu4chjuK/2SDNB5R120u7i8Z8PGrsuC2WerAHMwIpNU4fMNXnsLhpq8H04UL6wLApbC0YI3EUsljX8VUzAJQ5X2+2FsWOHKwNFbBbFeC4P/wnPs/9766CHOVUForZQuu2IAUhzuVNXdMbQQ/YNl6HNojIzgBsodLKJ+E2yU5izMz9nXFRnUhFV/63UBwJUa88JTUd9MpnAeTycfW3D/1W4T4M774OcDkoBv4TCf00d/Xl3Rn0M6hDGJG024G+y0TEBNkx2DpRhQPY8zXlx4zLHuO6tydQQQT5wi3zCNEBi8PlZKEEPQhOuLuAUx7aKgCmOEhA3dWJ8lfZvdGr7oKDtm223Mc07CLnMzGgOtKUH3G8a6yQkKELGtIVtqEEV+5AYvpwn+4b6/kH6sygEZZ+yP4+gcRX0sWpgI8MDdr0G9z+ZKYIsTtrvOYgTZkw4kdammbUDalP5p1c7e0AU/Jn7oeCt6W30pEWoEdTBldLQWo4jAP2xmGQKS+R+4eawrM7ye+lut6CBg6G3v9mO3GZLHSaRSLphwheGOt98Ta6Wo7blwzTaw4ncGC9ljy+Adojc+9KdCM9gJlXMIK0q7pHkF4TBGDGNuV3KeGZLiZ5BdnHhwvizZFHZ0/5fCHhVShCQPeAGtoE=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: QqG8OAMJOYJdetl4ctN0qQUzIHJ7P8o9LoU5bQztwv3pVyhzuwN4FtnuJXdmLnd6vi+V17KFhG3TPyTPwiWLC5/e/49hb5RJ0jzkqgnkvbClHlAz56kJ5h3ieKPuoUkZK6A9CXYnU1mS55DLrQYSJUrtaIMJYXhBr5+o9gMHm5+FFW/GfQrlPDMRC7Vwlv2EgFSFX0QB818bOSt42Hhrxefw0LTX00t35nB7oploQ5W3HGn4h1sCdPj1yzgW9F3gLMsoRAn9kJVnJyrw3cvL9Zqe0W4VNBaPi2it0EZoaVIl/Ve/0JwuUeERkSoWmAPAfmTjT84sRIf+41i5huq2JkExbFFBcuK2lTS3ZGUc4iVozvcFeymIRNKnylAwCtLb3SBzrn3buMVSI2jh3N5DAYMNfB0OTTmKqQUHHfK3zfquz+vD0NyolkfPMcp4TNCFO88IFGlXYzJVqWzWbpR/rooz6TykczhhQWSAqRXXsoAKgXu1aWL+srtuU8hRsvIcyqawWSIAQDF9k1mF+JbgfdKtyYZlpEQEdzmfHXWgmU90DZ74P+54ZYKINaTQvsm6N006xMtodRtvs/foxI+WlD95vb+DQIenl7ckXl0yKIETKimrH0M+XAOv69ZUZqZqE4Ns9nRBCv8QTMcNb5E78VJKGzUw8rnw7mL0stmLQSA=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild:1.1

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild:1.1
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: KRn6yJbnZkxsBOLX+Sp+X/OtJzdz/wrjorWz2F1y3sQO+KvTlfFhN3JTrbFMBxTbfr0hRDypbAyRfc3nMzkxQWjpvysaB1uJmbgQQXJhI5yJgpYVsQ/I+YathQHzKj1HhyrQDf9L2iMvI86NuqTe0nxui79q3i1q0QxiNwok0tt0m214IiLQREy25+rOLFMEwpUr0l+7slqbEN8KUsaRuQbYIBRJuP9rfV3jMSxUmBRap9jWZpnH9wkpbWT8MYGnyYGGpNuds9wBfp4eZLJ0GMkOA5vmEWo4TM8wqbFcDRqS1suuUT7I2saBt+3UtR43TBZy9JBC5MNVsPaMjfwxo/ns/MBQFRXCGqSyFGZ5nuEmCjAlORzivPBvBKVVjsh7HX0rzI4Zu5MTwjzZc2Xes3rOLx/JRv50sioMJMFRUbFa3dOvIhXwqlilzi0hPwAeZcsBsSkSD9s9CajSvkb6XR0Ef8h4+Jg6iibzHBSVpG2Ma/eShfx+yxaL8xdkI9i6YOSg9pBHtwFM9xzIM2XVEXL6o9lbVHIdMvdueZZEq798WfhhsKwBW1sOgz1OVUVG4chk4mnhcJcQc+ZkcIYv1CClTTUOKW1JmEEX3JpSWN78ObrD365WErImPYRmvgitYTHTWN16Iy1gWs/M44SxnXkhugJ52JFPwXF10KhQLW4=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
