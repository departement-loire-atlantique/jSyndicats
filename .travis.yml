env:
  global:
  - secure: HPp7vd0qJ/QnSyyJvhi/W3F1TiJArrRzz2GVnsBYT3m36QxHhdrpX1USsAHTkpABj/p205wuUN0pxhLCzdMjMi7mBKD6f54sAsP9TqgkdLxYB5StJsTzput28ctf4B1e9A/vuu87Nk4YyYl4+ZiMeg6Ytl6Zit4Tq+V4AmaugkKT9E+ddsVODGry2mGJ1zv/55dl/Ofx7tsQpc8amYQw6eZUYSx9A2e2zaV9IB1q7EC+39x70EeUbn6AXr0WNfFLdwzGxW22aep/6HwtH+yPoEi1kdw7yyiyELS01u9A+TmdddiFYPxSSW03YUzPp5yxUKYU/1N1EHPEBSHpHaCmM029wKxl+gT+JLr66PKwHjCefyTBNfbMUpSx/MFPFau1aPNBGO5GeSFqOS18lTJZSkl+sXsQVCWdgq3Cuf1e7BhrHY+t6ZSTYIAl6jrDuiOQONpELsftXxZsxPVlogHsAB2fsYFTJ7exhsIBTVNF0n/c0FJlVBkm2dku1bk10eJC7RC8JEthw6KJxDveFdpJJoG5hYwIuAG63dbcU6Pjg81s1YSA6VT2vSps/wcMJrLonCha1Woc1rvfcf4SWGkPKJlENo8tv/vSoenVGesra/RDpKH9FALWqA4XbHOPuvXTHJBUXn8qI6Is+wFCnLwh/oC86OfTjtqZHRbRB/jNRi4=
  - secure: cy+O5fFbA8hktx39e5DgWFK4vwnWB3MvZxwu4chjuK/2SDNB5R120u7i8Z8PGrsuC2WerAHMwIpNU4fMNXnsLhpq8H04UL6wLApbC0YI3EUsljX8VUzAJQ5X2+2FsWOHKwNFbBbFeC4P/wnPs/9766CHOVUForZQuu2IAUhzuVNXdMbQQ/YNl6HNojIzgBsodLKJ+E2yU5izMz9nXFRnUhFV/63UBwJUa88JTUd9MpnAeTycfW3D/1W4T4M774OcDkoBv4TCf00d/Xl3Rn0M6hDGJG024G+y0TEBNkx2DpRhQPY8zXlx4zLHuO6tydQQQT5wi3zCNEBi8PlZKEEPQhOuLuAUx7aKgCmOEhA3dWJ8lfZvdGr7oKDtm223Mc07CLnMzGgOtKUH3G8a6yQkKELGtIVtqEEV+5AYvpwn+4b6/kH6sygEZZ+yP4+gcRX0sWpgI8MDdr0G9z+ZKYIsTtrvOYgTZkw4kdammbUDalP5p1c7e0AU/Jn7oeCt6W30pEWoEdTBldLQWo4jAP2xmGQKS+R+4eawrM7ye+lut6CBg6G3v9mO3GZLHSaRSLphwheGOt98Ta6Wo7blwzTaw4ncGC9ljy+Adojc+9KdCM9gJlXMIK0q7pHkF4TBGDGNuV3KeGZLiZ5BdnHhwvizZFHZ0/5fCHhVShCQPeAGtoE=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: QqG8OAMJOYJdetl4ctN0qQUzIHJ7P8o9LoU5bQztwv3pVyhzuwN4FtnuJXdmLnd6vi+V17KFhG3TPyTPwiWLC5/e/49hb5RJ0jzkqgnkvbClHlAz56kJ5h3ieKPuoUkZK6A9CXYnU1mS55DLrQYSJUrtaIMJYXhBr5+o9gMHm5+FFW/GfQrlPDMRC7Vwlv2EgFSFX0QB818bOSt42Hhrxefw0LTX00t35nB7oploQ5W3HGn4h1sCdPj1yzgW9F3gLMsoRAn9kJVnJyrw3cvL9Zqe0W4VNBaPi2it0EZoaVIl/Ve/0JwuUeERkSoWmAPAfmTjT84sRIf+41i5huq2JkExbFFBcuK2lTS3ZGUc4iVozvcFeymIRNKnylAwCtLb3SBzrn3buMVSI2jh3N5DAYMNfB0OTTmKqQUHHfK3zfquz+vD0NyolkfPMcp4TNCFO88IFGlXYzJVqWzWbpR/rooz6TykczhhQWSAqRXXsoAKgXu1aWL+srtuU8hRsvIcyqawWSIAQDF9k1mF+JbgfdKtyYZlpEQEdzmfHXWgmU90DZ74P+54ZYKINaTQvsm6N006xMtodRtvs/foxI+WlD95vb+DQIenl7ckXl0yKIETKimrH0M+XAOv69ZUZqZqE4Ns9nRBCv8QTMcNb5E78VJKGzUw8rnw7mL0stmLQSA=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: hIIBKIDqFknMo5YtMFpJl3EAxjp2GZpV57CKrzX9cKNfn8sy4/tkUE74UNLeVVbNVDbRxmQ9m2rKE2weIP8UKA8f/tIzaCw2wr6Fs+SeXVNJO5LhGZ/L19Jt52E9kXqfT3TRVMiMi969Kux/KFpl8rCVp03RCLhzWw5xi0KovhMIArPdgZ6674Zcd/lB0NhLjnqNWLDoW2zKp0ojjIaIRK3Ff22HzSygSH6UpCP248tAguCzugOBZmDo5Bzpm+avNUWeSAO/N2yaxGrTs9xsc89rPGZDEwfuTvtJAFBUuKOXLtXApHKOtg0udCEcTdJsaKElBm25riChYfZ062zYwGE/nDQzQe7CMryCFR5H0hLVl72R9GW6o9TzbQGaFcd1vu693HTrQw3bB7Cj+G2XSnHFGFw59N1rlNYOwFf+PfFuEQO1uNBUrsBr7WhfYdXEdQxXXb1+8OQmfP6q8NZRqPipz+H41x/qOBvg6tp66QUAr3yovjbtTlRg4hA7vwl8strVh5vC7D0ps7phnx329Ifx+6ylE0seGJ6ZwDRlGIu4gopKdlnQjtQG1nf49OUQt5CwZOaG3kdHksMR+geKWVvYwcr0Qplf+UY/rLxoSnI/cHepoXRhjZOGKBd9n0LiBYJrNhk4xcBYKgezCXcyoGnu0RHYta5xnI0jUrDJthg=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
